<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Plan</title>
    <link rel="stylesheet" href="./css/main.css">
    <script src="./js/main.js" defer></script>
    <style>
        #output li {
            background: #ccc;
        }
    </style>
</head>

<body>
    <div>
        <div class="what_to_bring">
            <div class="title">
                <img src="/img/plane.png" alt="">
                <p>What to bring...</p>
            </div>
            <div class="chat"><input type="text" id="name" placeholder="NAME">
                <input id="bringing" type="text" placeholder="BRING"><button id="send1">ã€€SENDã€€</button>
            </div>
            <form class="form">
                <p id="output_bring"></p>
            </form>

            <div class="button"><button>ã€€ALL CHECKED?ã€€</button></div>

        </div>

    </div>

    <!-- <input type="checkbox" id="chkbx" name="chkbx" />
    <input type="checkbox" id="chkbx" name="chkbx" /> -->



    <!-- <div class="what_to_do">
        <p>What to do</p>
        <div><input id="plans_form" type="text"><button id="send2">send</button></div>
        <ul id="output_todo">
            <label for="plans" name="plans">plans</label>
        </ul>
        <div><button>done</button></div>
    </div> -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";
        // ğŸ”½ è¿½åŠ  / `9.2.0`ã®éƒ¨åˆ†ã‚’â†‘ã®Firestoreã‹ã‚‰è²¼ã‚Šä»˜ã‘ãŸã‚³ãƒ¼ãƒ‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã‚‹
        import {
            getFirestore,
            collection,
            addDoc,
            setDoc,
            getDoc,
            serverTimestamp,
            query, //ä¸¦ã³æ›¿ãˆãªã©æŒ‡å®šã™ã‚‹ã¨ãã«ï¼ˆä¾‹ãˆã°orderByã¨ã‹ï¼‰ä¸€ç·’ã«å¿…è¦ã«ãªã‚‹
            orderBy, //ä¸¦ã³æ›¿ãˆ
            onSnapshot, //ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™ãŸã‚ã®ã‚„ã¤
            doc,
            updateDoc,
        } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "",
            authDomain: "what-to-bring-b7960.firebaseapp.com",
            projectId: "what-to-bring-b7960",
            storageBucket: "what-to-bring-b7960.appspot.com",
            messagingSenderId: "896940630765",
            appId: "1:896940630765:web:f35d9a3e07a36499b0e2e4"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // é€ä¿¡æ™‚ã«å¿…è¦ãªå‡¦ç†
        $("#send1").on("click", function () {
            // console.log("#name");
            // console.log("#bringing");
            const postData1 = {
                name: $("#name").val(),
                bringing: $("#bringing").val(),
                check: false,///????????ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚ã«é€å—ä¿¡ã•ã›ã‚‹ï¼ï¼
            };
            // console.log(postData1);
            addDoc(collection(db, "bring_list"), postData1);
            $("#bringing").val("");

            // const blankCheckbox = postData1.check;
            // console.log(blankChekbox);

        });

        // JQUERYãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å¤‰æ›´
        $(document).on("change", "input[name = 'chkbx']", function () { //https://qumeru.com/magazine/440 //è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã«å¯¾ã—ã¦ã¯åå¿œãŒãªã‹ã£ãŸ
            // console.log('checkbox is checked.');
            let getId = $(this).parent().attr('id');
            console.log(getId);
            // ä¸Šã€è¦ªè¦ç´ ã‹ã‚‰IDã‚’æŠ½å‡º
            // const docRef = doc(db, "bring_list", getId);
            // const docSnap = getDoc(docRef);
            // const postRef = db.collection('bring_list').doc($(this).parent().attr('id'));
            // const firebase = db.collection('chat').doc('EkgDlCCHIFFjARXWq6TI').get();
            // console.log(firebase);
            const checkboxClick = doc(db, "bring_list", getId);
            console.log(checkboxClick.data);
            // if (checkboxClick === false) {
            updateDoc(checkboxClick, {
                check: true
            });

            // }
            // else {
            if (checkboxClick === true) {
                updateDoc(checkboxClick, {
                    check: false
                });
            }
        });


        // db.collection("users").doc("xxxxxxxx").delete().then(() => {
        //     console.log("å‰Šé™¤ã—ã¾ã—ãŸ");
        // })
        //     .catch((error) => {
        //         console.log(`å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ (${error})`);
        //     });
        ///////////////////////////////////////

        // æ¡ä»¶åˆ†å²ã§
        // setDoc(doc(db, "bring_list", getId), {
        //     check: true,
        //     name: 
        //     bringing:
        // });

        // ${ document.data.${document.data.name} : ${document.data.bringing}} : ${ document.data.bringing }
        // const checkboxClick = doc(db, "bring_list", "17rVag8911yuzuDAKdPc");
        // console.log(checkboxClick.data());
        // if (checkboxClick === 0) {
        //     checkboxClick++;

        // } console.log(checkboxClick);


        //ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’æ›´æ–°ã™ã‚‹ï¼ï¼ï¼/////////////////////////
        //////////////////////////////////////////////
        // const checkboxClick = doc(db, document.id);
        // console.log(checkboxClick);
        // $("#${document.data.check}").on("click", function () {
        //     if ((this) === 0) {

        //         console.log("#output_bring");
        //     }
        // });
        //////////////////////////////////////////

        // ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™ãŸã‚ã®å‡¦ç† FIREBASEã®ã©ã“ã‹ã‚‰ï¼Ÿã‚’ã‹ã
        onSnapshot(collection(db, "bring_list"), (querySnapshot) => {
            // console.log(querySnapshot.docs);
            const documents = [];
            querySnapshot.docs.forEach(function (doc) {
                const document = {
                    id: doc.id,
                    data: doc.data(),
                };
                documents.push(document);
            });
            console.log(documents);

            // ç”»é¢ã‚’è¡¨ç¤ºã•ã›ã‚‹å‡¦ç†ã®éš›ã«IFæ–‡ã§ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã«ãƒã‚§ãƒƒã‚¯ã‹ã©ã†ã‹ã‚’å…¥ã‚Œã‚‹
            const htmlElements = [];
            documents.forEach(function (document) {
                console.log(document.id);
                if (document.data.check === false) {
                    // updateDoc(checkboxClick, {
                    //     check: true
                    // });
                    //////falseãªã‚‰
                    htmlElements.push(`
                <p id="${document.id}">
                    <input name="chkbx" type="checkbox" id="${document.data.check}">${document.data.name} : ${document.data.bringing}
                    </p>
                `);
                    // updateDocTrue(document.id);
                } else { ///trueãªã‚‰ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒã‚§ãƒƒã‚¯ã™ã‚‹
                    htmlElements.push(`
                <p id="${document.id}">
                    <input name="chkbx" type="checkbox" checked id="${document.data.check}">${document.data.name} : ${document.data.bringing}
                    </p>
                `);

                }
                // if (htmlElements[length - 1].indexOf("checked")) {
                //     console.log("ok");
                // }
            });


            // console.log(htmlElements);
            $("#output_bring").html(htmlElements);

            // const checkboxClick = doc(db, "bring_list", "postData1");
            // console.log(checkboxClick);
        });
        // function updateDocTrue(id) {
        //     updateDoc(document.id, {
        //         check: true
        //     });




        // JQUERYãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å¤‰æ›´
        // $(document).on("change", "input[name = 'chkbx']", function () { //https://qumeru.com/magazine/440 //è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã«å¯¾ã—ã¦ã¯åå¿œãŒãªã‹ã£ãŸ
        //     // console.log('checkbox is checked.');
        //     let getId = $(this).parent().attr('id');
        //     // console.log(getId);ä¸Šã€è¦ªè¦ç´ ã‹ã‚‰IDã‚’æŠ½å‡º
        //     const checkboxClick = doc(db, "bring_list", getId);
        //     if (checkboxClick === false) {
        //         updateDoc(checkboxClick, {
        //             check: true
        //         });

        //     } else {
        //         updateDoc(checkboxClick, {
        //             check: false
        //         });
        //     }
        // });

    </script>
</body>

</html>